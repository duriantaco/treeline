
        <!DOCTYPE html>
        <html>
        <head>
            <title>Code Structure Visualization</title>
            <script
            src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js">
            </script>
            <style>
                body {
                    margin: 0;
                    font-family: 'Segoe UI', Arial, sans-serif;
                    background: #f8f9fa;
                }
                .node {
                    cursor: pointer;
                }
                .node circle {
                    fill: #fff; /* If no changes, node stays white */
                }
                .node:hover circle {
                    filter: brightness(0.95);
                }
                .node text {
                    font: 12px 'Segoe UI', sans-serif;
                    font-weight: 500;
                }
                .link {
                    stroke-width: 1.5px;
                    stroke-dasharray: 4;
                    opacity: 0.7;
                }

                .link-added { stroke: #22c55e; stroke-width: 3px; }
                .link-removed { stroke: #ef4444; stroke-width: 3px; opacity: 0.7; }

                .link-imports {
                    stroke: #7c3aed; /* purple */
                }
                .link-contains {
                    stroke: #059669; /* green */
                }
                .link-calls {
                    stroke: #ea580c; /* orange */
                }
                .tooltip {
                    position: absolute;
                    padding: 12px;
                    background: white;
                    border: none;
                    border-radius: 8px;
                    pointer-events: none;
                    font-size: 14px;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                    max-width: 300px;
                }
                #controls {
                    position: fixed;
                    top: 20px;
                    left: 20px;
                    background: white;
                    padding: 16px;
                    border-radius: 12px;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                    z-index: 1000;
                }
                #search {
                    width: 250px;
                    padding: 8px 12px;
                    margin-bottom: 12px;
                    border: 1px solid #e5e7eb;
                    border-radius: 6px;
                    font-size: 14px;
                }
                button {
                    background: #1d4ed8;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                    margin-right: 8px;
                    transition: background 0.3s;
                }
                button:hover {
                    background: #1e40af;
                }
                .legend {
                    position: fixed;
                    bottom: 20px;
                    left: 20px;
                    background: white;
                    padding: 16px;
                    border-radius: 12px;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                }
                .legend-item {
                    display: flex;
                    align-items: center;
                    margin-bottom: 8px;
                    font-size: 14px;
                }
                .legend-color {
                    width: 16px;
                    height: 16px;
                    border-radius: 4px;
                    margin-right: 8px;
                }
                .node-module circle { stroke: #0284c7; }
                .node-class circle { stroke: #0891b2; }
                .node-function circle { stroke: #0d9488; }

                .node-added circle { fill: #22c55e; }    /* Green for added */
                .node-removed circle { fill: #ef4444; }  /* Red for removed */

            .node-added circle { fill: #22c55e; }  /* Green */
            .node-removed circle { fill: #ef4444; opacity: 0.7; }  /* Red */
            .node-modified circle { fill: #eab308; }  /* Yellow */
            .link-added { stroke: #22c55e; stroke-width: 3px; }
            .link-removed { stroke: #ef4444; stroke-width: 3px; opacity: 0.7; }
            .node-highlighted circle {
                stroke: #3b82f6;
                stroke-width: 3px;
                filter: brightness(1.2);
            }
            .popup-button {
                padding: 8px 16px;
                background-color: #3b82f6;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                margin: 8px;
                display: none;
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1001;
            }
            .popup {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                display: none;
                max-width: 80%;
                max-height: 80vh;
                overflow-y: auto;
            }
            .popup.active {
                display: block;
            }
            .popup-close {
                position: absolute;
                right: 10px;
                top: 10px;
                cursor: pointer;
                font-size: 20px;
            }
            .diff-container {
                display: flex;
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
                font-size: 12px;
                line-height: 1.5;
                tab-size: 2;
            }
            .line-numbers {
                padding: 0 8px;
                text-align: right;
                background: #f6f8fa;
                color: #57606a;
                user-select: none;
                border-right: 1px solid #d0d7de;
            }
            .diff-content {
                padding-left: 10px;
                white-space: pre;
                overflow-x: auto;
                flex-grow: 1;
            }
            .diff-line {
                display: flex;
            }
            .diff-line-add {
                background-color: #e6ffec;
            }
            .diff-line-remove {
                background-color: #ffebe9;
            }
            .diff-header {
                color: #656d76;
                background: #f6f8fa;
            }
            .diff-line-number {
                color: #6e7781;
                width: 40px;
                text-align: right;
                padding-right: 10px;
                user-select: none;
            }

</style>
        </head>
        <body>
            <div id="controls">
                <input type="text" id="search" placeholder="Search nodes...">
                <button onclick="resetZoom()">Reset View</button>
                <button onclick="toggleLayout()">Toggle Layout</button>
            </div>
            <div class="legend">
                <h3 style="margin-top: 0; margin-bottom: 12px;">Legend</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background: #0284c7;"></div>
                    <span>Module</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #0891b2;"></div>
                    <span>Class</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #0d9488;"></div>
                    <span>Function</span>
                </div>
                <div style="margin-top: 16px; border-top: 1px solid #e5e7eb; padding-top: 12px;">
                    <div class="legend-item">
                        <div style="width: 40px; height: 2px;
                        background: #7c3aed;
                        margin-right: 8px;"></div>
                        <span>Imports</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 40px; height: 2px;
                        background: #059669;
                        margin-right: 8px;"></div>
                        <span>Contains</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 40px; height: 2px;
                        background: #ea580c;
                        margin-right: 8px;"></div>
                        <span>Calls</span>
                    </div>
                </div>

                <div style="margin-top: 16px; border-top: 1px solid #e5e7eb; padding-top: 12px;">
                    <h4 style="margin-top: 0; margin-bottom: 8px;">Changes</h4>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #22c55e;"></div>
                        <span>Added</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ef4444;"></div>
                        <span>Removed</span>
                    </div>
                </div>

            <button id="popup-button" class="popup-button">Show Details</button>
            <div id="popup" class="popup">
                <span class="popup-close">&times;</span>
                <h3>Node Details</h3>
                <p>Selected Node: <span id="selected-node"></span></p>
                <p>Git Diff:</p>
                <pre id="git-diff" style="max-height: 400px; overflow-y: auto; font-family: monospace;"></pre>
            </div>
            </div>
            <svg id="visualization"></svg>
            <script>
                document.getElementById("popup-button").addEventListener("click", function() {
                    document.getElementById("popup").classList.add("active");
                });

                document.querySelector(".popup-close").addEventListener("click", function() {
                    document.getElementById("popup").classList.remove("active");
                });

                window.addEventListener("click", function(event) {
                    const popup = document.getElementById("popup");
                    if (event.target === popup) {
                        popup.classList.remove("active");
                    }
                });
            </script>

            <script>
                const data = {"nodes": [{"id": 0, "name": "treeline.enhanced_analyzer", "type": "module", "status": "unchanged"}, {"id": 1, "name": "treeline.core", "type": "module", "status": "unchanged"}, {"id": 2, "name": "setup", "type": "module", "status": "unchanged"}, {"id": 3, "name": "treeline.__init__", "type": "module", "status": "unchanged"}, {"id": 4, "name": "tests.test_security_detection", "type": "module", "status": "unchanged"}, {"id": 5, "name": "treeline.models.enhanced_analyzer", "type": "module", "status": "unchanged"}, {"id": 6, "name": "treeline.diff_visualizer", "type": "module", "status": "added"}, {"id": 7, "name": "tests.test_special_char", "type": "module", "status": "added"}, {"id": 8, "name": "treeline.security_analyzer", "type": "module", "status": "added"}, {"id": 9, "name": "treeline.models.dependency_analyzer", "type": "module", "status": "added"}, {"id": 10, "name": "treeline.models.core", "type": "module", "status": "added"}, {"id": 11, "name": "treeline.models.__init__", "type": "module", "status": "added"}, {"id": 12, "name": "tests.test_nested_dir", "type": "module", "status": "added"}, {"id": 13, "name": "tests.test_core", "type": "module", "status": "added"}, {"id": 14, "name": "treeline.analyzer", "type": "module", "status": "added"}, {"id": 15, "name": "treeline.__main__", "type": "module", "status": "added"}, {"id": 16, "name": "source.conf", "type": "module", "status": "added"}, {"id": 17, "name": "treeline.models.analyzer", "type": "module", "status": "added"}, {"id": 18, "name": "treeline.type_checker", "type": "module", "status": "added"}, {"id": 19, "name": "tests.test_empty_dir", "type": "module", "status": "added"}, {"id": 20, "name": "treeline.dependency_analyzer", "type": "module", "status": "added"}, {"id": 21, "name": "tests.test_treeline", "type": "module", "status": "added"}, {"id": 22, "name": "treeline.models.security_analyzer", "type": "module", "status": "added"}, {"id": 23, "name": "TestTreelineSecurity", "type": "class", "status": "added"}, {"id": 24, "name": "TestSpecialCharacters", "type": "class", "status": "added"}, {"id": 25, "name": "TestEmptyDirectory", "type": "class", "status": "added"}, {"id": 26, "name": "TestTreeGenerator", "type": "class", "status": "added"}, {"id": 27, "name": "TestTreeLine", "type": "class", "status": "added"}, {"id": 28, "name": "TestNestedDirectories", "type": "class", "status": "added"}, {"id": 29, "name": "TypeValidator", "type": "class", "status": "added"}, {"id": 30, "name": "TypeChecked", "type": "class", "status": "added"}, {"id": 31, "name": "ValidationError", "type": "class", "status": "added"}, {"id": 32, "name": "ModuleDependencyAnalyzer", "type": "class", "status": "added"}, {"id": 33, "name": "CodeAnalyzer", "type": "class", "status": "added"}, {"id": 34, "name": "EnhancedCodeAnalyzer", "type": "class", "status": "added"}, {"id": 35, "name": "TreelineSecurity", "type": "class", "status": "added"}, {"id": 36, "name": "FunctionLocation", "type": "class", "status": "added"}, {"id": 37, "name": "FunctionCallInfo", "type": "class", "status": "added"}, {"id": 38, "name": "ClassMethod", "type": "class", "status": "added"}, {"id": 39, "name": "ClassInfo", "type": "class", "status": "added"}, {"id": 40, "name": "ModuleMetrics", "type": "class", "status": "added"}, {"id": 41, "name": "ComplexFunction", "type": "class", "status": "added"}, {"id": 42, "name": "MethodInfo", "type": "class", "status": "added"}, {"id": 43, "name": "Node", "type": "class", "status": "added"}, {"id": 44, "name": "Link", "type": "class", "status": "added"}, {"id": 45, "name": "GraphData", "type": "class", "status": "added"}, {"id": 46, "name": "FunctionCall", "type": "class", "status": "added"}, {"id": 47, "name": "CodeStructure", "type": "class", "status": "added"}, {"id": 48, "name": "FunctionNode", "type": "class", "status": "added"}, {"id": 49, "name": "ClassNode", "type": "class", "status": "added"}, {"id": 50, "name": "AnalyzerConfig", "type": "class", "status": "added"}, {"id": 51, "name": "FunctionMetrics", "type": "class", "status": "added"}, {"id": 52, "name": "ClassMetrics", "type": "class", "status": "added"}, {"id": 53, "name": "CodeDuplication", "type": "class", "status": "added"}, {"id": 54, "name": "QualityIssue", "type": "class", "status": "added"}, {"id": 55, "name": "CodeStructure", "type": "class", "status": "added"}, {"id": 56, "name": "TreeOptions", "type": "class", "status": "added"}, {"id": 57, "name": "ModuleMetrics", "type": "class", "status": "added"}, {"id": 58, "name": "SecurityPattern", "type": "class", "status": "added"}, {"id": 59, "name": "SecurityIssue", "type": "class", "status": "added"}, {"id": 60, "name": "SecurityPatterns", "type": "class", "status": "added"}, {"id": 61, "name": "DiffVisualizer", "type": "class", "status": "added"}, {"id": 62, "name": "__call__", "type": "function", "status": "added"}, {"id": 63, "name": "create_default_ignore", "type": "function", "status": "added"}, {"id": 64, "name": "read_ignore_patterns", "type": "function", "status": "added"}, {"id": 65, "name": "should_ignore", "type": "function", "status": "added"}, {"id": 66, "name": "clean_for_markdown", "type": "function", "status": "added"}, {"id": 67, "name": "format_structure", "type": "function", "status": "added"}, {"id": 68, "name": "generate_markdown_report", "type": "function", "status": "added"}, {"id": 69, "name": "generate_tree", "type": "function", "status": "added"}, {"id": 70, "name": "main", "type": "function", "status": "added"}, {"id": 6, "name": "tests.test_special_char", "type": "module", "status": "removed"}, {"id": 7, "name": "treeline.security_analyzer", "type": "module", "status": "removed"}, {"id": 8, "name": "treeline.models.dependency_analyzer", "type": "module", "status": "removed"}, {"id": 9, "name": "treeline.models.core", "type": "module", "status": "removed"}, {"id": 10, "name": "treeline.models.__init__", "type": "module", "status": "removed"}, {"id": 11, "name": "tests.test_nested_dir", "type": "module", "status": "removed"}, {"id": 12, "name": "tests.test_core", "type": "module", "status": "removed"}, {"id": 13, "name": "treeline.analyzer", "type": "module", "status": "removed"}, {"id": 14, "name": "treeline.__main__", "type": "module", "status": "removed"}, {"id": 15, "name": "source.conf", "type": "module", "status": "removed"}, {"id": 16, "name": "treeline.models.analyzer", "type": "module", "status": "removed"}, {"id": 17, "name": "treeline.type_checker", "type": "module", "status": "removed"}, {"id": 18, "name": "tests.test_empty_dir", "type": "module", "status": "removed"}, {"id": 19, "name": "treeline.dependency_analyzer", "type": "module", "status": "removed"}, {"id": 20, "name": "tests.test_treeline", "type": "module", "status": "removed"}, {"id": 21, "name": "treeline.models.security_analyzer", "type": "module", "status": "removed"}, {"id": 22, "name": "TestTreelineSecurity", "type": "class", "status": "removed"}, {"id": 23, "name": "TestSpecialCharacters", "type": "class", "status": "removed"}, {"id": 24, "name": "TestEmptyDirectory", "type": "class", "status": "removed"}, {"id": 25, "name": "TestTreeGenerator", "type": "class", "status": "removed"}, {"id": 26, "name": "TestTreeLine", "type": "class", "status": "removed"}, {"id": 27, "name": "TestNestedDirectories", "type": "class", "status": "removed"}, {"id": 28, "name": "TypeValidator", "type": "class", "status": "removed"}, {"id": 29, "name": "TypeChecked", "type": "class", "status": "removed"}, {"id": 30, "name": "ValidationError", "type": "class", "status": "removed"}, {"id": 31, "name": "ModuleDependencyAnalyzer", "type": "class", "status": "removed"}, {"id": 32, "name": "CodeAnalyzer", "type": "class", "status": "removed"}, {"id": 33, "name": "EnhancedCodeAnalyzer", "type": "class", "status": "removed"}, {"id": 34, "name": "TreelineSecurity", "type": "class", "status": "removed"}, {"id": 35, "name": "FunctionLocation", "type": "class", "status": "removed"}, {"id": 36, "name": "FunctionCallInfo", "type": "class", "status": "removed"}, {"id": 37, "name": "ClassMethod", "type": "class", "status": "removed"}, {"id": 38, "name": "ClassInfo", "type": "class", "status": "removed"}, {"id": 39, "name": "ModuleMetrics", "type": "class", "status": "removed"}, {"id": 40, "name": "ComplexFunction", "type": "class", "status": "removed"}, {"id": 41, "name": "MethodInfo", "type": "class", "status": "removed"}, {"id": 42, "name": "Node", "type": "class", "status": "removed"}, {"id": 43, "name": "Link", "type": "class", "status": "removed"}, {"id": 44, "name": "GraphData", "type": "class", "status": "removed"}, {"id": 45, "name": "FunctionCall", "type": "class", "status": "removed"}, {"id": 46, "name": "CodeStructure", "type": "class", "status": "removed"}, {"id": 47, "name": "FunctionNode", "type": "class", "status": "removed"}, {"id": 48, "name": "ClassNode", "type": "class", "status": "removed"}, {"id": 49, "name": "AnalyzerConfig", "type": "class", "status": "removed"}, {"id": 50, "name": "FunctionMetrics", "type": "class", "status": "removed"}, {"id": 51, "name": "ClassMetrics", "type": "class", "status": "removed"}, {"id": 52, "name": "CodeDuplication", "type": "class", "status": "removed"}, {"id": 53, "name": "QualityIssue", "type": "class", "status": "removed"}, {"id": 54, "name": "CodeStructure", "type": "class", "status": "removed"}, {"id": 55, "name": "TreeOptions", "type": "class", "status": "removed"}, {"id": 56, "name": "ModuleMetrics", "type": "class", "status": "removed"}, {"id": 57, "name": "SecurityPattern", "type": "class", "status": "removed"}, {"id": 58, "name": "SecurityIssue", "type": "class", "status": "removed"}, {"id": 59, "name": "SecurityPatterns", "type": "class", "status": "removed"}, {"id": 60, "name": "__call__", "type": "function", "status": "removed"}, {"id": 61, "name": "create_default_ignore", "type": "function", "status": "removed"}, {"id": 62, "name": "read_ignore_patterns", "type": "function", "status": "removed"}, {"id": 63, "name": "should_ignore", "type": "function", "status": "removed"}, {"id": 64, "name": "clean_for_markdown", "type": "function", "status": "removed"}, {"id": 65, "name": "format_structure", "type": "function", "status": "removed"}, {"id": 66, "name": "generate_markdown_report", "type": "function", "status": "removed"}, {"id": 67, "name": "generate_tree", "type": "function", "status": "removed"}, {"id": 68, "name": "main", "type": "function", "status": "removed"}], "links": [{"source": 4, "target": 23, "type": "contains", "status": "added"}, {"source": 7, "target": 24, "type": "contains", "status": "added"}, {"source": 19, "target": 25, "type": "contains", "status": "added"}, {"source": 13, "target": 26, "type": "contains", "status": "added"}, {"source": 21, "target": 27, "type": "contains", "status": "added"}, {"source": 12, "target": 28, "type": "contains", "status": "added"}, {"source": 18, "target": 29, "type": "contains", "status": "added"}, {"source": 18, "target": 30, "type": "contains", "status": "added"}, {"source": 18, "target": 31, "type": "contains", "status": "added"}, {"source": 20, "target": 32, "type": "contains", "status": "added"}, {"source": 14, "target": 33, "type": "contains", "status": "added"}, {"source": 0, "target": 34, "type": "contains", "status": "added"}, {"source": 8, "target": 35, "type": "contains", "status": "unchanged"}, {"source": 9, "target": 36, "type": "contains", "status": "added"}, {"source": 9, "target": 37, "type": "contains", "status": "added"}, {"source": 9, "target": 38, "type": "contains", "status": "added"}, {"source": 9, "target": 39, "type": "contains", "status": "added"}, {"source": 9, "target": 40, "type": "contains", "status": "added"}, {"source": 9, "target": 41, "type": "contains", "status": "added"}, {"source": 9, "target": 42, "type": "contains", "status": "added"}, {"source": 9, "target": 43, "type": "contains", "status": "added"}, {"source": 9, "target": 44, "type": "contains", "status": "added"}, {"source": 9, "target": 45, "type": "contains", "status": "added"}, {"source": 17, "target": 46, "type": "contains", "status": "added"}, {"source": 17, "target": 47, "type": "contains", "status": "added"}, {"source": 17, "target": 48, "type": "contains", "status": "added"}, {"source": 17, "target": 49, "type": "contains", "status": "added"}, {"source": 17, "target": 50, "type": "contains", "status": "added"}, {"source": 5, "target": 51, "type": "contains", "status": "unchanged"}, {"source": 5, "target": 52, "type": "contains", "status": "unchanged"}, {"source": 5, "target": 53, "type": "contains", "status": "unchanged"}, {"source": 5, "target": 54, "type": "contains", "status": "added"}, {"source": 10, "target": 55, "type": "contains", "status": "added"}, {"source": 10, "target": 56, "type": "contains", "status": "added"}, {"source": 10, "target": 57, "type": "contains", "status": "added"}, {"source": 22, "target": 58, "type": "contains", "status": "added"}, {"source": 22, "target": 59, "type": "contains", "status": "added"}, {"source": 22, "target": 60, "type": "contains", "status": "added"}, {"source": 6, "target": 61, "type": "contains", "status": "added"}, {"source": 3, "target": 62, "type": "contains", "status": "added"}, {"source": 1, "target": 63, "type": "contains", "status": "unchanged"}, {"source": 1, "target": 64, "type": "contains", "status": "unchanged"}, {"source": 1, "target": 65, "type": "contains", "status": "unchanged"}, {"source": 1, "target": 66, "type": "contains", "status": "unchanged"}, {"source": 1, "target": 67, "type": "contains", "status": "unchanged"}, {"source": 1, "target": 68, "type": "contains", "status": "unchanged"}, {"source": 1, "target": 69, "type": "contains", "status": "added"}, {"source": 1, "target": 70, "type": "contains", "status": "added"}, {"source": 62, "target": 69, "type": "calls", "status": "added"}, {"source": 70, "target": 69, "type": "calls", "status": "added"}, {"source": 62, "target": 69, "type": "calls", "status": "added"}, {"source": 70, "target": 69, "type": "calls", "status": "added"}, {"source": 68, "target": 66, "type": "calls", "status": "added"}, {"source": 68, "target": 66, "type": "calls", "status": "added"}, {"source": 69, "target": 64, "type": "calls", "status": "added"}, {"source": 69, "target": 64, "type": "calls", "status": "added"}, {"source": 69, "target": 68, "type": "calls", "status": "added"}, {"source": 69, "target": 68, "type": "calls", "status": "added"}, {"source": 69, "target": 65, "type": "calls", "status": "added"}, {"source": 69, "target": 65, "type": "calls", "status": "added"}, {"source": 70, "target": 63, "type": "calls", "status": "added"}, {"source": 70, "target": 63, "type": "calls", "status": "added"}, {"source": 4, "target": 8, "type": "imports", "status": "added"}, {"source": 7, "target": 1, "type": "imports", "status": "added"}, {"source": 19, "target": 1, "type": "imports", "status": "added"}, {"source": 13, "target": 1, "type": "imports", "status": "added"}, {"source": 12, "target": 1, "type": "imports", "status": "unchanged"}, {"source": 20, "target": 9, "type": "imports", "status": "added"}, {"source": 14, "target": 18, "type": "imports", "status": "added"}, {"source": 14, "target": 17, "type": "imports", "status": "added"}, {"source": 0, "target": 5, "type": "imports", "status": "unchanged"}, {"source": 0, "target": 8, "type": "imports", "status": "added"}, {"source": 1, "target": 18, "type": "imports", "status": "added"}, {"source": 1, "target": 20, "type": "imports", "status": "added"}, {"source": 1, "target": 0, "type": "imports", "status": "unchanged"}, {"source": 1, "target": 10, "type": "imports", "status": "added"}, {"source": 1, "target": 6, "type": "imports", "status": "added"}, {"source": 8, "target": 22, "type": "imports", "status": "added"}, {"source": 15, "target": 1, "type": "imports", "status": "added"}, {"source": 17, "target": 18, "type": "imports", "status": "added"}, {"source": 5, "target": 18, "type": "imports", "status": "added"}, {"source": 10, "target": 18, "type": "imports", "status": "added"}, {"source": 6, "target": 20, "type": "imports", "status": "added"}, {"source": 6, "target": 9, "type": "imports", "status": "added"}, {"source": 4, "target": 22, "type": "contains", "status": "removed"}, {"source": 6, "target": 23, "type": "contains", "status": "removed"}, {"source": 18, "target": 24, "type": "contains", "status": "removed"}, {"source": 12, "target": 25, "type": "contains", "status": "removed"}, {"source": 20, "target": 26, "type": "contains", "status": "removed"}, {"source": 11, "target": 27, "type": "contains", "status": "removed"}, {"source": 17, "target": 28, "type": "contains", "status": "removed"}, {"source": 17, "target": 29, "type": "contains", "status": "removed"}, {"source": 17, "target": 30, "type": "contains", "status": "removed"}, {"source": 19, "target": 31, "type": "contains", "status": "removed"}, {"source": 13, "target": 32, "type": "contains", "status": "removed"}, {"source": 0, "target": 33, "type": "contains", "status": "removed"}, {"source": 7, "target": 34, "type": "contains", "status": "removed"}, {"source": 8, "target": 36, "type": "contains", "status": "removed"}, {"source": 8, "target": 37, "type": "contains", "status": "removed"}, {"source": 8, "target": 38, "type": "contains", "status": "removed"}, {"source": 8, "target": 39, "type": "contains", "status": "removed"}, {"source": 8, "target": 40, "type": "contains", "status": "removed"}, {"source": 8, "target": 41, "type": "contains", "status": "removed"}, {"source": 8, "target": 42, "type": "contains", "status": "removed"}, {"source": 8, "target": 43, "type": "contains", "status": "removed"}, {"source": 8, "target": 44, "type": "contains", "status": "removed"}, {"source": 16, "target": 45, "type": "contains", "status": "removed"}, {"source": 16, "target": 46, "type": "contains", "status": "removed"}, {"source": 16, "target": 47, "type": "contains", "status": "removed"}, {"source": 16, "target": 48, "type": "contains", "status": "removed"}, {"source": 16, "target": 49, "type": "contains", "status": "removed"}, {"source": 5, "target": 50, "type": "contains", "status": "removed"}, {"source": 9, "target": 54, "type": "contains", "status": "removed"}, {"source": 9, "target": 55, "type": "contains", "status": "removed"}, {"source": 9, "target": 56, "type": "contains", "status": "removed"}, {"source": 21, "target": 57, "type": "contains", "status": "removed"}, {"source": 21, "target": 58, "type": "contains", "status": "removed"}, {"source": 21, "target": 59, "type": "contains", "status": "removed"}, {"source": 3, "target": 60, "type": "contains", "status": "removed"}, {"source": 1, "target": 61, "type": "contains", "status": "removed"}, {"source": 1, "target": 62, "type": "contains", "status": "removed"}, {"source": 60, "target": 67, "type": "calls", "status": "removed"}, {"source": 68, "target": 67, "type": "calls", "status": "removed"}, {"source": 66, "target": 64, "type": "calls", "status": "removed"}, {"source": 67, "target": 62, "type": "calls", "status": "removed"}, {"source": 67, "target": 66, "type": "calls", "status": "removed"}, {"source": 67, "target": 63, "type": "calls", "status": "removed"}, {"source": 68, "target": 61, "type": "calls", "status": "removed"}, {"source": 4, "target": 7, "type": "imports", "status": "removed"}, {"source": 6, "target": 1, "type": "imports", "status": "removed"}, {"source": 18, "target": 1, "type": "imports", "status": "removed"}, {"source": 11, "target": 1, "type": "imports", "status": "removed"}, {"source": 19, "target": 8, "type": "imports", "status": "removed"}, {"source": 13, "target": 17, "type": "imports", "status": "removed"}, {"source": 13, "target": 16, "type": "imports", "status": "removed"}, {"source": 0, "target": 7, "type": "imports", "status": "removed"}, {"source": 1, "target": 17, "type": "imports", "status": "removed"}, {"source": 1, "target": 19, "type": "imports", "status": "removed"}, {"source": 1, "target": 9, "type": "imports", "status": "removed"}, {"source": 7, "target": 21, "type": "imports", "status": "removed"}, {"source": 14, "target": 1, "type": "imports", "status": "removed"}, {"source": 16, "target": 17, "type": "imports", "status": "removed"}, {"source": 5, "target": 17, "type": "imports", "status": "removed"}, {"source": 9, "target": 17, "type": "imports", "status": "removed"}], "commits": {"before": "HEAD^", "after": "HEAD"}, "file_diffs": {"treeline.enhanced_analyzer": "diff --git a/treeline/enhanced_analyzer.py b/treeline/enhanced_analyzer.py\nindex 43f9c83..bafb3ee 100644\n--- a/treeline/enhanced_analyzer.py\n+++ b/treeline/enhanced_analyzer.py\n@@ -8,9 +8,6 @@ from treeline.models.enhanced_analyzer import (\n     FunctionMetrics,\n     QualityIssue,\n )\n-from treeline.security_analyzer import TreelineSecurity\n-\n-security_scanner = TreelineSecurity()\n \n \n class EnhancedCodeAnalyzer:\n@@ -177,7 +174,7 @@ class EnhancedCodeAnalyzer:\n \n         Based on McCabe, 1976 and implementation in Radon/SonarQube.\n         \"\"\"\n-        complexity = 1  # Base complexity\n+        complexity = 1\n         for child in ast.walk(node):\n             if isinstance(child, (ast.If, ast.While, ast.For, ast.ExceptHandler)):\n                 complexity += 1\n@@ -197,10 +194,10 @@ class EnhancedCodeAnalyzer:\n \n             for child in ast.iter_child_nodes(node):\n                 if isinstance(child, (ast.If, ast.While, ast.For)):\n-                    complexity += 1 + nesting  # Base + nesting level\n+                    complexity += 1 + nesting\n                     complexity += walk_cognitive(child, nesting + 1)\n                 elif isinstance(child, ast.BoolOp):\n-                    complexity += len(child.values) - 1  # Each additional condition\n+                    complexity += len(child.values) - 1\n                 else:\n                     complexity += walk_cognitive(child, nesting)\n \n@@ -551,7 +548,7 @@ class EnhancedCodeAnalyzer:\n                 if isinstance(node, ast.Import):\n                     for alias in node.names:\n                         dependencies.add(alias.name.split(\".\")[0])\n-                else:  # ImportFrom\n+                else:\n                     if node.module:\n                         dependencies.add(node.module.split(\".\")[0])\n \n@@ -592,7 +589,6 @@ class EnhancedCodeAnalyzer:\n                 self._format_overview_section(),\n                 self._format_issues_section(),\n                 self._format_metrics_section(),\n-                security_scanner.get_security_section(),\n             ]\n         )", "treeline.core": "diff --git a/treeline/core.py b/treeline/core.py\nindex f76aa7e..c702d7b 100644\n--- a/treeline/core.py\n+++ b/treeline/core.py\n@@ -5,10 +5,13 @@ from pathlib import Path\n from typing import Dict, List\n \n from treeline.dependency_analyzer import ModuleDependencyAnalyzer\n+from treeline.diff_visualizer import DiffVisualizer\n from treeline.enhanced_analyzer import EnhancedCodeAnalyzer\n from treeline.models.core import CodeStructure, TreeOptions\n from treeline.type_checker import ValidationError\n \n+visualizer = DiffVisualizer()\n+\n \n def create_default_ignore():\n     \"\"\"Create default .treeline-ignore if it doesn't exist\"\"\"\n@@ -269,6 +272,9 @@ def main():\n             treeline --hide-structure     # Hide code structure\n             treeline --no-params          # Hide function parameters\n             treeline -h                   # Show this help message\n+            treeline --diff               # Compare with previous commit\n+            treeline --diff HASH          # Compare with specific commit\n+            treeline --diff HASH1 HASH2   # Compare between two commits\n         \"\"\",\n     )\n \n@@ -293,8 +299,40 @@ def main():\n         \"--no-params\", action=\"store_true\", help=\"Hide function parameters\"\n     )\n \n+    parser.add_argument(\n+        \"--diff\",\n+        nargs=\"*\",\n+        help=\"Compare code structure between commits. Usage: --diff [before_commit] [after_commit]\",\n+    )\n     args = parser.parse_args()\n \n+    if args.diff is not None:\n+        try:\n+            from treeline.diff_visualizer import DiffVisualizer\n+\n+            visualizer = DiffVisualizer()\n+\n+            if len(args.diff) == 0:\n+                diff_html = visualizer.generate_structural_diff(\"HEAD^\", \"HEAD\")\n+            elif len(args.diff) == 1:\n+                diff_html = visualizer.generate_structural_diff(args.diff[0], \"HEAD\")\n+            elif len(args.diff) == 2:\n+                diff_html = visualizer.generate_structural_diff(\n+                    args.diff[0], args.diff[1]\n+                )\n+            else:\n+                print(\"Error: Too many commits specified\")\n+                return\n+\n+            output_path = \"code_diff.html\"\n+            with open(output_path, \"w\") as f:\n+                f.write(diff_html)\n+            print(f\"\\nVisualization generated: {output_path}\")\n+            return\n+        except Exception as e:\n+            print(f\"Error: {str(e)}\")\n+            return\n+\n     print(\n         generate_tree(\n             args.directory,", "setup": "", "treeline.__init__": "diff --git a/treeline/__init__.py b/treeline/__init__.py\nindex 0bb545b..287eda3 100644\n--- a/treeline/__init__.py\n+++ b/treeline/__init__.py\n@@ -1,10 +1,17 @@\n import sys\n \n from .core import generate_tree\n+from .diff_visualizer import DiffVisualizer\n \n \n def __call__(*args, **kwargs):\n     return generate_tree(*args, **kwargs)\n \n \n-sys.modules[__name__] = type(\"TreeLine\", (), {\"__call__\": staticmethod(__call__)})()\n+sys.modules[__name__] = type(\n+    \"TreeLine\",\n+    (),\n+    {\"__call__\": staticmethod(__call__), \"DiffVisualizer\": DiffVisualizer},\n+)()\n+\n+__all__ = [\"generate_tree\", \"DiffVisualizer\"]", "tests.test_security_detection": "diff --git a/tests/test_security_detection.py b/tests/test_security_detection.py\ndeleted file mode 100644\nindex 235d0b8..0000000\n--- a/tests/test_security_detection.py\n+++ /dev/null\n@@ -1,89 +0,0 @@\n-import ast\n-import os\n-import unittest\n-from pathlib import Path\n-\n-from treeline.security_analyzer import TreelineSecurity\n-\n-\n-class TestTreelineSecurity(unittest.TestCase):\n-    def setUp(self):\n-        self.analyzer = TreelineSecurity()\n-        self.test_files = []\n-\n-    def create_test_file(self, code: str, filename: str) -> Path:\n-        \"\"\"Helper method to create a temporary test file.\"\"\"\n-        path = Path(filename)\n-        with open(path, \"w\") as f:\n-            f.write(code)\n-        self.test_files.append(path)\n-        return path\n-\n-    def debug_ast(self, code: str):\n-        \"\"\"Helper to print AST for debugging\"\"\"\n-        tree = ast.parse(code)\n-        return tree\n-\n-    def test_sql_injection_detection(self):\n-        code = \"\"\"def get_user_data(user_id):\n-    query = \"SELECT * FROM users WHERE id = \" + user_id\n-    cursor.execute(query)\"\"\"\n-        path = self.create_test_file(code, \"test_sql_injection.py\")\n-        self.analyzer.analyze_file(path)\n-        issues = self.analyzer.security_issues.get(\"sql_injection\", [])\n-        self.assertTrue(\n-            len(issues) > 0, \"SQL injection vulnerability was not detected.\"\n-        )\n-\n-    def test_command_injection_detection(self):\n-        code = \"\"\"import os\n-\n-def execute_command(cmd):\n-    os.system(\"ls \" + cmd)\"\"\"\n-        path = self.create_test_file(code, \"test_command_injection.py\")\n-        self.analyzer.analyze_file(path)\n-        issues = self.analyzer.security_issues.get(\"command_injection\", [])\n-        self.assertTrue(\n-            len(issues) > 0, \"Command injection vulnerability was not detected.\"\n-        )\n-\n-    def test_unsafe_deserialization_detection(self):\n-        code = \"\"\"import pickle\n-\n-def load_data(data):\n-    obj = pickle.loads(data)\n-    return obj\"\"\"\n-        path = self.create_test_file(code, \"test_deserialization.py\")\n-        self.analyzer.analyze_file(path)\n-        issues = self.analyzer.security_issues.get(\"deserialization\", [])\n-\n-        self.assertTrue(\n-            len(issues) > 0, \"Unsafe deserialization vulnerability not detected.\"\n-        )\n-\n-    def test_hardcoded_secret_detection(self):\n-        code = \"\"\"def connect_to_db():\n-    password = \"super_secret_password\"\n-    # Use password to connect to the database\"\"\"\n-        path = self.create_test_file(code, \"test_hardcoded_secret.py\")\n-        self.analyzer.analyze_file(path)\n-        issues = self.analyzer.security_issues.get(\"hardcoded_secret\", [])\n-        self.assertTrue(len(issues) > 0, \"Hardcoded secret was not detected.\")\n-\n-    def test_file_operation_detection(self):\n-        code = \"\"\"def delete_file(filename):\n-    os.remove(\"/var/www/\" + filename)\"\"\"\n-        path = self.create_test_file(code, \"test_file_operation.py\")\n-        self.analyzer.analyze_file(path)\n-        issues = self.analyzer.security_issues.get(\"file_operations\", [])\n-\n-        self.assertTrue(len(issues) > 0, \"Insecure file operation not detected.\")\n-\n-    def tearDown(self):\n-        for file in self.test_files:\n-            if file.exists():\n-                os.remove(file)\n-\n-\n-if __name__ == \"__main__\":\n-    unittest.main()", "treeline.models.enhanced_analyzer": "", "treeline.diff_visualizer": "diff --git a/treeline/diff_visualizer.py b/treeline/diff_visualizer.py\nnew file mode 100644\nindex 0000000..a8d5749\n--- /dev/null\n+++ b/treeline/diff_visualizer.py\n@@ -0,0 +1,276 @@\n+import json\n+import subprocess\n+from pathlib import Path\n+from tempfile import TemporaryDirectory\n+from typing import Dict\n+\n+from treeline.dependency_analyzer import ModuleDependencyAnalyzer\n+from treeline.models.dependency_analyzer import GraphData, Node\n+\n+\n+class DiffVisualizer:\n+    \"\"\"Visualizes structural differences between different versions of Python code.\"\"\"\n+\n+    def __init__(self, repo_path: str = \".\"):\n+        self.repo_path = Path(repo_path)\n+        self.dep_analyzer = ModuleDependencyAnalyzer()\n+\n+    def _serialize_graph_data(self, graph: GraphData) -> Dict:\n+        \"\"\"Convert a GraphData object to a serializable dictionary\"\"\"\n+        return {\n+            \"nodes\": [self._serialize_node(n) for n in graph.nodes],\n+            \"links\": [self._serialize_link(link) for link in graph.links],\n+        }\n+\n+    def _serialize_node(self, node: Node) -> Dict:\n+        \"\"\"Convert a Node object to a serializable dictionary\"\"\"\n+        return {\n+            \"id\": str(node.id),\n+            \"name\": str(node.name),\n+            \"type\": str(node.type),\n+            \"group\": getattr(node, \"group\", 1),\n+            \"size\": getattr(node, \"size\", 1),\n+        }\n+\n+    def _serialize_link(self, link: Dict) -> Dict:\n+        \"\"\"Convert a link dictionary to a serializable format\"\"\"\n+        return {\n+            \"source\": (\n+                str(link[\"source\"])\n+                if isinstance(link[\"source\"], (str, int))\n+                else str(link[\"source\"].id)\n+            ),\n+            \"target\": (\n+                str(link[\"target\"])\n+                if isinstance(link[\"target\"], (str, int))\n+                else str(link[\"target\"].id)\n+            ),\n+            \"type\": str(link.get(\"type\", \"default\")),\n+            \"value\": link.get(\"value\", 1),\n+        }\n+\n+    def _node_was_modified_serial(self, before: Dict, after: Dict) -> bool:\n+        \"\"\"Check if a serialized node's important properties changed\"\"\"\n+        return (\n+            before[\"name\"] != after[\"name\"]\n+            or before[\"type\"] != after[\"type\"]\n+            or before.get(\"group\") != after.get(\"group\")\n+        )\n+\n+    def _get_node_changes_serial(self, before: Dict, after: Dict) -> Dict:\n+        \"\"\"Get detailed changes for modified serialized nodes\"\"\"\n+        changes = {}\n+        for key in [\"name\", \"type\", \"group\"]:\n+            if before.get(key) != after.get(key):\n+                changes[key] = {\"before\": before.get(key), \"after\": after.get(key)}\n+        return changes\n+\n+    def _run_git_command(self, *args) -> str:\n+        \"\"\"Run a git command with error handling\"\"\"\n+        try:\n+            result = subprocess.run(\n+                [\"git\"] + list(args),\n+                capture_output=True,\n+                text=True,\n+                check=True,\n+                cwd=self.repo_path,\n+                encoding=\"utf-8\",\n+                timeout=30,\n+            )\n+            return result.stdout.strip()\n+        except subprocess.TimeoutExpired:\n+            raise RuntimeError(\"Git command timed out\")\n+        except subprocess.CalledProcessError as e:\n+            raise RuntimeError(f\"Git command failed: {e.stderr}\")\n+        except Exception as e:\n+            raise RuntimeError(f\"Unexpected error: {str(e)}\")\n+\n+    def _is_git_repo(self) -> bool:\n+        try:\n+            self._run_git_command(\"rev-parse\", \"--is-inside-work-tree\")\n+            return True\n+        except RuntimeError:\n+            return False\n+\n+    def _commit_exists(self, commit_sha: str) -> bool:\n+        try:\n+            self._run_git_command(\"cat-file\", \"-e\", commit_sha)\n+            return True\n+        except RuntimeError:\n+            return False\n+\n+    def _analyze_commit(self, commit_sha: str) -> Dict:\n+        \"\"\"Analyze a specific commit and return serializable data\"\"\"\n+        if not self._commit_exists(commit_sha):\n+            raise ValueError(f\"Commit {commit_sha} not found\")\n+\n+        with TemporaryDirectory() as temp_dir:\n+            temp_path = Path(temp_dir)\n+            try:\n+                self._run_git_command(\"worktree\", \"add\", str(temp_path), commit_sha)\n+                self.dep_analyzer.analyze_directory(temp_path)\n+                html_viz = self.dep_analyzer.generate_html_visualization()\n+                viz_data = json.loads(html_viz.split(\"const data = \")[1].split(\";\")[0])\n+\n+                return {\n+                    \"nodes\": [\n+                        {\"id\": n[\"id\"], \"name\": n[\"name\"], \"type\": n[\"type\"]}\n+                        for n in viz_data[\"nodes\"]\n+                    ],\n+                    \"links\": [\n+                        {\n+                            \"source\": link[\"source\"],\n+                            \"target\": link[\"target\"],\n+                            \"type\": link[\"type\"],\n+                        }\n+                        for link in viz_data[\"links\"]\n+                    ],\n+                }\n+            finally:\n+                self._run_git_command(\"worktree\", \"remove\", \"-f\", str(temp_path))\n+\n+    def _compute_changes(self, before_data: Dict, after_data: Dict) -> Dict:\n+        \"\"\"Compute the differences between two dependency graphs\"\"\"\n+\n+        def node_key(node):\n+            return f\"{node['id']}-{node['name']}-{node['type']}\"\n+\n+        def link_key(link):\n+            return f\"{link['source']}-{link['target']}-{link['type']}\"\n+\n+        before_node_keys = {node_key(n) for n in before_data[\"nodes\"]}\n+        after_node_keys = {node_key(n) for n in after_data[\"nodes\"]}\n+        before_link_keys = {link_key(link) for link in before_data[\"links\"]}\n+        after_link_keys = {link_key(link) for link in after_data[\"links\"]}\n+\n+        changes = {\n+            \"added\": {\n+                \"nodes\": [\n+                    n\n+                    for n in after_data[\"nodes\"]\n+                    if node_key(n) not in before_node_keys\n+                ],\n+                \"links\": [\n+                    link\n+                    for link in after_data[\"links\"]\n+                    if link_key(link) not in before_link_keys\n+                ],\n+            },\n+            \"removed\": {\n+                \"nodes\": [\n+                    n\n+                    for n in before_data[\"nodes\"]\n+                    if node_key(n) not in after_node_keys\n+                ],\n+                \"links\": [\n+                    link\n+                    for link in before_data[\"links\"]\n+                    if link_key(link) not in after_link_keys\n+                ],\n+            },\n+            \"modified\": [],\n+        }\n+\n+        return changes\n+\n+    def generate_structural_diff(self, before_commit: str, after_commit: str) -> str:\n+        \"\"\"Generate a visual diff between two commits\"\"\"\n+        if not self._is_git_repo():\n+            raise ValueError(\"Not a git repository\")\n+\n+        before_data = self._analyze_commit(before_commit)\n+        after_data = self._analyze_commit(after_commit)\n+        changes = self._compute_changes(before_data, after_data)\n+\n+        for node in after_data[\"nodes\"]:\n+            if any(n[\"name\"] == node[\"name\"] for n in changes[\"added\"][\"nodes\"]):\n+                node[\"status\"] = \"added\"\n+            else:\n+                node[\"status\"] = \"unchanged\"\n+\n+        for link in after_data[\"links\"]:\n+            if any(\n+                added_link[\"source\"] == link[\"source\"]\n+                and added_link[\"target\"] == link[\"target\"]\n+                for added_link in changes[\"added\"][\"links\"]\n+            ):\n+                link[\"status\"] = \"added\"\n+            else:\n+                link[\"status\"] = \"unchanged\"\n+\n+        for node in changes[\"removed\"][\"nodes\"]:\n+            node[\"status\"] = \"removed\"\n+            after_data[\"nodes\"].append(node)\n+\n+        for link in changes[\"removed\"][\"links\"]:\n+            link[\"status\"] = \"removed\"\n+            after_data[\"links\"].append(link)\n+\n+        template = self.dep_analyzer.html_template\n+\n+        diff_styles = \"\"\"\n+            .node-added circle { fill: #22c55e; }  /* Green */\n+            .node-removed circle { fill: #ef4444; opacity: 0.7; }  /* Red */\n+            .node-modified circle { fill: #eab308; }  /* Yellow */\n+            .link-added { stroke: #22c55e; stroke-width: 3px; }\n+            .link-removed { stroke: #ef4444; stroke-width: 3px; opacity: 0.7; }\n+        \"\"\"\n+        template = template.replace(\"</style>\", f\"{diff_styles}\\n</style>\")\n+\n+        original_link_code = \"\"\"const link = g.append(\"g\")\n+                    .selectAll(\"path\")\n+                    .data(data.links)\n+                    .join(\"path\")\n+                    .attr(\"class\", d => `link link-${d.type}`)\n+                    .attr(\"marker-end\", d => `url(#arrow-${d.type})`);\"\"\"\n+\n+        original_node_code = \"\"\"const node = g.append(\"g\")\n+                    .selectAll(\".node\")\n+                    .data(data.nodes)\n+                    .join(\"g\")\n+                    .attr(\"class\", d => `node node-${d.type}`)\n+                    .call(drag(simulation));\"\"\"\n+\n+        new_link_code = \"\"\"const link = g.append(\"g\")\n+                    .selectAll(\"path\")\n+                    .data(data.links)\n+                    .join(\"path\")\n+                    .attr(\"class\", function(d) {\n+                        return \"link link-\" + d.type + (d.status ? \" link-\" + d.status : \"\");\n+                    })\n+                    .attr(\"marker-end\", function(d) {\n+                        return \"url(#arrow-\" + d.type + \")\";\n+                    });\"\"\"\n+\n+        new_node_code = \"\"\"const node = g.append(\"g\")\n+                    .selectAll(\".node\")\n+                    .data(data.nodes)\n+                    .join(\"g\")\n+                    .attr(\"class\", function(d) {\n+                        return \"node node-\" + d.type + (d.status ? \" node-\" + d.status : \"\");\n+                    })\n+                    .call(drag(simulation));\"\"\"\n+\n+        template = template.replace(original_link_code, new_link_code)\n+        template = template.replace(original_node_code, new_node_code)\n+\n+        change_legend = \"\"\"\n+                <div style=\"margin-top: 16px; border-top: 1px solid #e5e7eb; padding-top: 12px;\">\n+                    <h4 style=\"margin-top: 0; margin-bottom: 8px;\">Changes</h4>\n+                    <div class=\"legend-item\">\n+                        <div class=\"legend-color\" style=\"background: #22c55e;\"></div>\n+                        <span>Added</span>\n+                    </div>\n+                    <div class=\"legend-item\">\n+                        <div class=\"legend-color\" style=\"background: #ef4444;\"></div>\n+                        <span>Removed</span>\n+                    </div>\n+                </div>\"\"\"\n+\n+        legend_end = '</div>\\n            <svg id=\"visualization\"></svg>'\n+        template = template.replace(\n+            legend_end,\n+            f'{change_legend}\\n            </div>\\n            <svg id=\"visualization\"></svg>',\n+        )\n+\n+        return template.replace(\"GRAPH_DATA_PLACEHOLDER\", json.dumps(after_data))", "tests.test_special_char": "", "treeline.security_analyzer": "diff --git a/treeline/security_analyzer.py b/treeline/security_analyzer.py\ndeleted file mode 100644\nindex df730cd..0000000\n--- a/treeline/security_analyzer.py\n+++ /dev/null\n@@ -1,185 +0,0 @@\n-import ast\n-from collections import defaultdict\n-from pathlib import Path\n-from typing import Dict, List\n-\n-from treeline.models.security_analyzer import (\n-    SecurityIssue,\n-    SecurityPattern,\n-    SecurityPatterns,\n-)\n-\n-\n-class TreelineSecurity:\n-    def __init__(self):\n-        self.security_issues: Dict[str, List[SecurityIssue]] = defaultdict(list)\n-        self.imports: Dict[str, str] = {}\n-        self.tree: ast.AST = None\n-\n-        self.RISKY_PATTERNS = SecurityPatterns(\n-            sql_injection=SecurityPattern(\n-                patterns={\"execute\", \"executemany\", \"raw\", \"raw_query\"},\n-                safe_patterns={\"parameterize\", \"execute_params\"},\n-            ),\n-            command_injection=SecurityPattern(\n-                patterns={\"system\", \"popen\", \"run\", \"shell\", \"spawn\", \"call\"},\n-                modules={\"os\", \"subprocess\", \"commands\"},\n-            ),\n-            deserialization=SecurityPattern(\n-                patterns={\"loads\", \"load\", \"parse\"},\n-                risky_modules={\"pickle\", \"yaml\", \"marshal\"},\n-                safe_modules={\"json\"},\n-            ),\n-            file_operations=SecurityPattern(\n-                patterns={\n-                    \"open\",\n-                    \"read\",\n-                    \"write\",\n-                    \"save\",\n-                    \"load\",\n-                    \"exec\",\n-                    \"eval\",\n-                    \"remove\",\n-                    \"unlink\",\n-                }\n-            ),\n-        )\n-\n-    def analyze_file(self, file_path: Path) -> None:\n-        try:\n-            with open(file_path, \"r\", encoding=\"utf-8\") as f:\n-                content = f.read()\n-            self.tree = ast.parse(content)\n-            self._collect_imports(self.tree)\n-            self._scan_security_issues(self.tree, str(file_path))\n-        except Exception as e:\n-            self.security_issues[\"errors\"].append(\n-                {\n-                    \"description\": f\"Security scan failed: {str(e)}\",\n-                    \"file\": str(file_path),\n-                    \"line\": 0,\n-                }\n-            )\n-\n-    def _collect_imports(self, tree: ast.AST) -> None:\n-        self.imports = {}\n-        for node in ast.walk(tree):\n-            if isinstance(node, ast.Import):\n-                for alias in node.names:\n-                    self.imports[alias.asname or alias.name] = alias.name\n-            elif isinstance(node, ast.ImportFrom):\n-                module = node.module or \"\"\n-                for alias in node.names:\n-                    full_name = f\"{module}.{alias.name}\" if module else alias.name\n-                    self.imports[alias.asname or alias.name] = full_name\n-\n-    def _scan_security_issues(self, tree: ast.AST, filename: str) -> None:\n-        for node in ast.walk(tree):\n-            if isinstance(node, ast.Call):\n-                self._check_all_dangerous_calls(node, filename)\n-            elif isinstance(node, ast.BinOp):\n-                if isinstance(node.op, ast.Add):\n-                    self._check_string_concat(node, filename)\n-            elif isinstance(node, ast.Assign):\n-                self._check_hardcoded_secrets(node, filename)\n-\n-    def _check_all_dangerous_calls(self, node: ast.Call, filename: str) -> None:\n-        if isinstance(node.func, ast.Attribute):\n-            func_name = node.func.attr\n-            print(f\"Method call: {func_name}\")\n-\n-            if isinstance(node.func.value, ast.Name):\n-                module_name = node.func.value.id\n-                orig_module = self.imports.get(module_name, module_name)\n-                print(f\"Module: {module_name} -> {orig_module}\")\n-\n-                if (\n-                    orig_module in self.RISKY_PATTERNS.command_injection.modules\n-                    and func_name in self.RISKY_PATTERNS.command_injection.patterns\n-                ):\n-                    self._add_issue(\n-                        \"command_injection\",\n-                        f\"Possible command injection in {orig_module}.{func_name}()\",\n-                        filename,\n-                        node.lineno,\n-                    )\n-\n-                if (\n-                    orig_module in {\"os\", \"pathlib\", \"shutil\"}\n-                    and func_name in self.RISKY_PATTERNS.file_operations.patterns\n-                ):\n-                    if any(isinstance(arg, ast.BinOp) for arg in node.args):\n-                        self._add_issue(\n-                            \"file_operations\",\n-                            f\"Insecure file operation in {orig_module}.{func_name}()\",\n-                            filename,\n-                            node.lineno,\n-                        )\n-\n-                if (\n-                    orig_module in self.RISKY_PATTERNS.deserialization.risky_modules\n-                    and func_name in self.RISKY_PATTERNS.deserialization.patterns\n-                ):\n-                    self._add_issue(\n-                        \"deserialization\",\n-                        f\"Unsafe deserialization using {orig_module}.{func_name}()\",\n-                        filename,\n-                        node.lineno,\n-                    )\n-\n-    def _check_string_concat(self, node: ast.BinOp, filename: str) -> None:\n-        \"\"\"\n-        Check for string concatenation with SQL-like commands.\n-        \"\"\"\n-\n-        if isinstance(node.left, ast.Constant):\n-            print(f\"Left operand: {node.left.value}\")\n-        if isinstance(node.right, ast.Constant):\n-            print(f\"Right operand: {node.right.value}\")\n-\n-        if (\n-            isinstance(node.left, ast.Constant) and isinstance(node.left.value, str)\n-        ) or (\n-            isinstance(node.right, ast.Constant) and isinstance(node.right.value, str)\n-        ):\n-            sql_keywords = [\"select\", \"insert\", \"update\", \"delete\", \"exec\", \"eval\"]\n-            print(\"Checking SQL keywords\")\n-            if any(\n-                keyword in str(node.left.value).lower()\n-                for keyword in sql_keywords\n-                if hasattr(node.left, \"value\")\n-            ):\n-                print(\"Found SQL keyword in left operand\")\n-                self._add_issue(\n-                    \"sql_injection\",\n-                    \"String concatenation with SQL-like commands detected\",\n-                    filename,\n-                    node.lineno,\n-                )\n-\n-    def _check_hardcoded_secrets(self, node: ast.Assign, filename: str) -> None:\n-        print(f\"\\nChecking hardcoded secrets: {ast.dump(node, indent=2)}\")\n-\n-        for target in node.targets:\n-            if isinstance(target, ast.Name):\n-                name = target.id.lower()\n-                print(f\"Checking variable name: {name}\")\n-                if any(\n-                    word in name\n-                    for word in [\"password\", \"secret\", \"key\", \"token\", \"api\"]\n-                ):\n-                    print(f\"Found secret-like name: {name}\")\n-                    if isinstance(node.value, ast.Constant):\n-                        print(f\"Found hardcoded value: {node.value.value}\")\n-                        self._add_issue(\n-                            \"hardcoded_secret\",\n-                            f\"Hardcoded secret found in variable '{target.id}'\",\n-                            filename,\n-                            node.lineno,\n-                        )\n-\n-    def _add_issue(\n-        self, category: str, description: str, filename: str, line: int\n-    ) -> None:\n-        issue = SecurityIssue(description=description, file=filename, line=line)\n-        self.security_issues[category].append(issue.__dict__)", "treeline.models.dependency_analyzer": "", "treeline.models.core": "", "treeline.models.__init__": "diff --git a/treeline/models/__init__.py b/treeline/models/__init__.py\nindex e69de29..c89b0b1 100644\n--- a/treeline/models/__init__.py\n+++ b/treeline/models/__init__.py\n@@ -0,0 +1,4 @@\n+from .core import CodeStructure, TreeOptions\n+from .dependency_analyzer import GraphData, Node\n+\n+__all__ = [\"CodeStructure\", \"TreeOptions\", \"Node\", \"GraphData\"]", "tests.test_nested_dir": "", "tests.test_core": "", "treeline.analyzer": "", "treeline.__main__": "", "source.conf": "", "treeline.models.analyzer": "", "treeline.type_checker": "", "tests.test_empty_dir": "", "treeline.dependency_analyzer": "diff --git a/treeline/dependency_analyzer.py b/treeline/dependency_analyzer.py\nindex 8aed02e..e571422 100644\n--- a/treeline/dependency_analyzer.py\n+++ b/treeline/dependency_analyzer.py\n@@ -7,7 +7,6 @@ from treeline.models.dependency_analyzer import (\n     ComplexFunction,\n     FunctionCallInfo,\n     FunctionLocation,\n-    GraphData,\n     Link,\n     MethodInfo,\n     ModuleMetrics,\n@@ -43,9 +42,7 @@ class ModuleDependencyAnalyzer:\n                     cursor: pointer;\n                 }\n                 .node circle {\n-                    fill: #fff;\n-                    stroke-width: 2px;\n-                    transition: all 0.3s;\n+                    fill: #fff; /* If no changes, node stays white */\n                 }\n                 .node:hover circle {\n                     filter: brightness(0.95);\n@@ -59,6 +56,10 @@ class ModuleDependencyAnalyzer:\n                     stroke-dasharray: 4;\n                     opacity: 0.7;\n                 }\n+\n+                .link-added { stroke: #22c55e; stroke-width: 3px; }\n+                .link-removed { stroke: #ef4444; stroke-width: 3px; opacity: 0.7; }\n+\n                 .link-imports {\n                     stroke: #7c3aed; /* purple */\n                 }\n@@ -135,6 +136,9 @@ class ModuleDependencyAnalyzer:\n                 .node-module circle { stroke: #0284c7; }\n                 .node-class circle { stroke: #0891b2; }\n                 .node-function circle { stroke: #0d9488; }\n+\n+                .node-added circle { fill: #22c55e; }    /* Green for added */\n+                .node-removed circle { fill: #ef4444; }  /* Red for removed */\n             </style>\n         </head>\n         <body>\n@@ -249,7 +253,6 @@ class ModuleDependencyAnalyzer:\n \n                 node.append(\"circle\")\n                     .attr(\"r\", d => getNodeSize(d))\n-                    .style(\"fill\", \"#fff\");\n \n                 node.append(\"text\")\n                     .attr(\"dy\", \".35em\")\n@@ -791,10 +794,25 @@ class ModuleDependencyAnalyzer:\n         validated_nodes = [Node(**node) for node in nodes]\n         validated_links = [Link(**link) for link in links]\n \n-        graph_data = GraphData(nodes=validated_nodes, links=validated_links).__dict__\n+        graph_data = {\n+            \"nodes\": [\n+                {\"id\": node.id, \"name\": node.name, \"type\": node.type}\n+                for node in validated_nodes\n+            ],\n+            \"links\": [\n+                {\"source\": link.source, \"target\": link.target, \"type\": link.type}\n+                for link in validated_links\n+            ],\n+        }\n \n         json_data = json.dumps(graph_data)\n \n+        print(\"Number of nodes:\", len(nodes))\n+        print(\"Sample nodes:\", nodes[:3] if nodes else \"No nodes\")\n+        print(\"Number of links:\", len(links))\n+        print(\"Sample links:\", links[:3] if links else \"No links\")\n+        print(\"Graph data:\", json_data[:200] if json_data else \"No data\")\n+\n         return self.html_template.replace(\"GRAPH_DATA_PLACEHOLDER\", json_data)\n \n     def generate_summary_report(self) -> str:", "tests.test_treeline": "", "treeline.models.security_analyzer": "diff --git a/treeline/models/security_analyzer.py b/treeline/models/security_analyzer.py\ndeleted file mode 100644\nindex 9160d00..0000000\n--- a/treeline/models/security_analyzer.py\n+++ /dev/null\n@@ -1,29 +0,0 @@\n-# models/security.py\n-from dataclasses import dataclass\n-from typing import Optional, Set\n-\n-from ..type_checker import TypeChecked\n-\n-\n-@dataclass\n-class SecurityPattern(TypeChecked):\n-    patterns: Set[str]\n-    safe_patterns: Optional[Set[str]] = None\n-    modules: Optional[Set[str]] = None\n-    risky_modules: Optional[Set[str]] = None\n-    safe_modules: Optional[Set[str]] = None\n-\n-\n-@dataclass\n-class SecurityIssue(TypeChecked):\n-    description: str\n-    file: str\n-    line: int\n-\n-\n-@dataclass\n-class SecurityPatterns(TypeChecked):\n-    sql_injection: SecurityPattern\n-    command_injection: SecurityPattern\n-    deserialization: SecurityPattern\n-    file_operations: SecurityPattern", "TestTreelineSecurity": "", "TestSpecialCharacters": "", "TestEmptyDirectory": "", "TestTreeGenerator": "", "TestTreeLine": "", "TestNestedDirectories": "", "TypeValidator": "", "TypeChecked": "", "ValidationError": "", "ModuleDependencyAnalyzer": "", "CodeAnalyzer": "", "EnhancedCodeAnalyzer": "", "TreelineSecurity": "", "FunctionLocation": "", "FunctionCallInfo": "", "ClassMethod": "", "ClassInfo": "", "ModuleMetrics": "", "ComplexFunction": "", "MethodInfo": "", "Node": "", "Link": "", "GraphData": "", "FunctionCall": "", "CodeStructure": "", "FunctionNode": "", "ClassNode": "", "AnalyzerConfig": "", "FunctionMetrics": "", "ClassMetrics": "", "CodeDuplication": "", "QualityIssue": "", "TreeOptions": "", "SecurityPattern": "", "SecurityIssue": "", "SecurityPatterns": "", "DiffVisualizer": "", "__call__": "", "create_default_ignore": "", "read_ignore_patterns": "", "should_ignore": "", "clean_for_markdown": "", "format_structure": "", "generate_markdown_report": "", "generate_tree": "", "main": ""}};

                let width = window.innerWidth;
                let height = window.innerHeight;

                const svg = d3.select("#visualization")
                    .attr("width", width)
                    .attr("height", height);

                // Define arrow markers for different link types
                svg.append("defs").selectAll("marker")
                    .data(["imports", "contains", "calls"])
                    .join("marker")
                    .attr("id", d => `arrow-${d}`)
                    .attr("viewBox", "0 -5 10 10")
                    .attr("refX", 15)
                    .attr("refY", 0)
                    .attr("markerWidth", 6)
                    .attr("markerHeight", 6)
                    .attr("orient", "auto")
                    .append("path")
                    .attr("fill", d => d === "imports" ? "#7c3aed" : d === "contains" ? "#059669" : "#ea580c")
                    .attr("d", "M0,-5L10,0L0,5");

                const g = svg.append("g");

                const zoom = d3.zoom()
                    .scaleExtent([0.1, 4])
                    .on("zoom", (event) => {
                        g.attr("transform", event.transform);
                    });

                svg.call(zoom);

                function resetZoom() {
                    svg.transition().duration(750).call(
                        zoom.transform,
                        d3.zoomIdentity
                    );
                }

                let isRadial = false;
                const simulation = d3.forceSimulation()
                    .force("link", d3.forceLink().id(d => d.id).distance(150))
                    .force("charge", d3.forceManyBody().strength(-1000))
                    .force("x", d3.forceX(width / 2).strength(0.1))
                    .force("y", d3.forceY(height / 2).strength(0.1))
                    .force("collision", d3.forceCollide().radius(50));

                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

                const link = g.append("g")
                    .selectAll("path")
                    .data(data.links)
                    .join("path")
                    .attr("class", function(d) {
                        return "link link-" + d.type + (d.status ? " link-" + d.status : "");
                    })
                    .attr("marker-end", function(d) {
                        return "url(#arrow-" + d.type + ")";
                    });

                const node = g.append("g")
                    .selectAll(".node")
                    .data(data.nodes)
                    .join("g")
                    .attr("class", function(d) {
                        return "node node-" + d.type + (d.status ? " node-" + d.status : "");
                    })
                    .call(drag(simulation))
                    .on("click", function(event, d) {
                        // Remove highlight from all nodes
                        node.classed("node-highlighted", false);

                        // Add highlight to clicked node
                        d3.select(this).classed("node-highlighted", true);

                        // Update node name
                        document.getElementById("selected-node").textContent = d.name;

                        // Get the pre-computed diff for this node
                        const diffText = data.file_diffs[d.name] || 'No changes found';

                        // Format the diff with colors
                        document.getElementById("git-diff").innerHTML = diffText
                            .split('\n')
                            .map(line => {
                                if (line.startsWith('+')) {
                                    return '<div style="background-color: #e6ffec; color: #1a7f37;">' + line + '</div>';
                                } else if (line.startsWith('-')) {
                                    return '<div style="background-color: #ffebe9; color: #cf222e;">' + line + '</div>';
                                } else if (line.startsWith('@@')) {
                                    return '<div style="color: #656d76; background: #f6f8fa;">' + line + '</div>';
                                }
                                return '<div>' + line + '</div>';
                            })
                            .join('\n');

                        // Show the button
                        document.getElementById("popup-button").style.display = "block";
                    });

                node.append("circle")
                    .attr("r", d => getNodeSize(d))

                node.append("text")
                    .attr("dy", ".35em")
                    .attr("x", d => getNodeSize(d) + 5)
                    .text(d => d.name)
                    .style("fill", "#333");

                // Add hover effects
                node.on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);

                    let connections = data.links.filter(l =>
                        l.source.id === d.id || l.target.id === d.id
                    );

                    let tooltipContent = `<strong>${d.name}</strong><br>Type: ${d.type}<br><br>`;
                    if (connections.length > 0) {
                        tooltipContent += "Connections:<br>";
                        connections.forEach(c => {
                            if (c.source.id === d.id) {
                                tooltipContent += `→ ${c.target.name} (${c.type})<br>`;
                            } else {
                                tooltipContent += `← ${c.source.name} (${c.type})<br>`;
                            }
                        });
                    }

                    tooltip.html(tooltipContent)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");

                    // Highlight connected nodes
                    node.style("opacity", n =>
                        n.id === d.id ||
                        connections.some(c => c.source.id === n.id || c.target.id === n.id) ? 1 : 0.1
                    );
                    link.style("opacity", l =>
                        l.source.id === d.id || l.target.id === d.id ? 1 : 0.1
                    );
                })
                .on("mouseout", function() {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                    node.style("opacity", 1);
                    link.style("opacity", 0.7);
                });

                simulation
                    .nodes(data.nodes)
                    .on("tick", ticked);

                simulation.force("link")
                    .links(data.links);

                function ticked() {
                    link.attr("d", linkArc);
                    node.attr("transform", d => `translate(${d.x},${d.y})`);
                }

                function linkArc(d) {
                    return `M${d.source.x},${d.source.y}L${d.target.x},${d.target.y}`;
                }

                function getNodeSize(node) {
                    switch(node.type) {
                        case 'module': return 12;
                        case 'class': return 10;
                        default: return 8;
                    }
                }

                function drag(simulation) {
                    function dragstarted(event) {
                        if (!event.active) simulation.alphaTarget(0.3).restart();
                        event.subject.fx = event.subject.x;
                        event.subject.fy = event.subject.y;
                    }

                    function dragged(event) {
                        event.subject.fx = event.x;
                        event.subject.fy = event.y;
                    }

                    function dragended(event) {
                        if (!event.active) simulation.alphaTarget(0);
                        event.subject.fx = null;
                        event.subject.fy = null;
                    }

                    return d3.drag()
                        .on("start", dragstarted)
                        .on("drag", dragged)
                        .on("end", dragended);
                }

                function toggleLayout() {
                    isRadial = !isRadial;
                    if (isRadial) {
                        simulation
                            .force("x", null)
                            .force("y", null)
                            .force("r", d3.forceRadial(250, width / 2, height / 2))
                            .force("charge", d3.forceManyBody().strength(-100));
                    } else {
                        simulation
                            .force("r", null)
                            .force("x", d3.forceX(width / 2).strength(0.1))
                            .force("y", d3.forceY(height / 2).strength(0.1))
                            .force("charge", d3.forceManyBody().strength(-1000));
                    }
                    simulation.alpha(1).restart();
                }

                // Search functionality with highlighting
                d3.select("#search").on("input", function() {
                    const term = this.value.toLowerCase();
                    if (term === "") {
                        node.style("opacity", 1);
                        link.style("opacity", 0.7);
                        return;
                    }

                    const matchedNodes = new Set();
                    node.each(function(d) {
                        if (d.name.toLowerCase().includes(term)) {
                            matchedNodes.add(d.id);
                            // Also add connected nodes
                            data.links.forEach(l => {
                                if (l.source.id === d.id) matchedNodes.add(l.target.id);
                                if (l.target.id === d.id) matchedNodes.add(l.source.id);
                            });
                        }
                    });

                    node.style("opacity", d => matchedNodes.has(d.id) ? 1 : 0.1);
                    link.style("opacity", d =>
                        matchedNodes.has(d.source.id) && matchedNodes.has(d.target.id) ? 0.7 : 0.1
                    );
                });

                // Window resize handler
                window.addEventListener("resize", () => {
                    width = window.innerWidth;
                    height = window.innerHeight;
                    svg.attr("width", width).attr("height", height);
                    simulation.force("center", d3.forceCenter(width / 2, height / 2));
                    simulation.alpha(1).restart();
                });
            </script>
        </body>
        </html>
